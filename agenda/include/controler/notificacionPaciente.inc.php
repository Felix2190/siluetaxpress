<?php

// -----------------------------------------------------------------------------------------------------------------#
// ---------------------------------------Archivos necesarios Require Include---------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#
require_once FOLDER_MODEL_EXTEND. "model.sucursal.inc.php";
require_once FOLDER_MODEL_EXTEND. "model.notificacion.inc.php";
require_once FOLDER_MODEL_EXTEND. "model.notificacion_paciente.inc.php";
// -----------------------------------------------------------------------------------------------------------------#
// --------------------------------------------Inicializacion de control--------------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#

// -----------------------------------------------------------------------------------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#

// -----------------------------------------------------------------------------------------------------------------#
// ----------------------------------------------------Funciones----------------------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#

// -----------------------------------------------------------------------------------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#

// -----------------------------------------------------------------------------------------------------------------#
// ---------------------------------------------------Seccion AJAX--------------------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#

$xajax = new xajax();


function guardarNotificacion($idNoti,$arrNombre,$seccion,$fin){
    $r=new xajaxResponse();
    global $objSession;
 
    $errores=0;
    foreach ($arrNombre as $idPaciente){
        $notifPaciente = new ModeloNotificacion_paciente();
        $notifPaciente->setIdNotificacion($idNoti);
        $notifPaciente->setEstatusEspera();
        $notifPaciente->setFechaEnvio(date("Y-m-d H:i:s"));
        $notifPaciente->setIdPaciente($idPaciente);
        $notifPaciente->Guardar();
        if ($notifPaciente->getError()){
            $errores++;
        }
    }
    $r->call("mostrarMsjExito","Se ha regristrado la notificaci&oacute;n. ".($errores>0?("$errores  no se enviaron"):(count($arrNombre)-$errores ." $seccion enviados")),5);
    if ($fin)
        $r->redirect("notificacionPaciente.php",40);
    return $r;
    
}

$xajax->registerFunction("guardarNotificacion");

$xajax->processRequest();


// -----------------------------------------------------------------------------------------------------------------#
// -------------------------------------------Inicializacion de variables-------------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#
$Susurcal = new ModeloSucursal();
$arrSucursal=$Susurcal->obtenerSucuralesSMS();

?>