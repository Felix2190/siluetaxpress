<?php
// -----------------------------------------------------------------------------------------------------------------#
// ---------------------------------------Archivos necesarios Require Include---------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#
require_once FOLDER_MODEL_EXTEND. "model.sucursal.inc.php";
require_once FOLDER_MODEL_EXTEND. "model.usuario.inc.php";
require_once FOLDER_MODEL_EXTEND. "model.tipousuario.inc.php";
// -----------------------------------------------------------------------------------------------------------------#
// --------------------------------------------Inicializacion de control--------------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#

// -----------------------------------------------------------------------------------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#

// -----------------------------------------------------------------------------------------------------------------#
// ----------------------------------------------------Funciones----------------------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#

// -----------------------------------------------------------------------------------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#

// -----------------------------------------------------------------------------------------------------------------#
// ---------------------------------------------------Seccion AJAX--------------------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#

$xajax = new xajax();


function guardar($info){
    global $objSession;
    $datos=json_decode($info,true);
    $r=new xajaxResponse();
    
    $usuario = new ModeloUsuario();
    $usuario->setIdUsuario($objSession->getidUsuario());
    
    $usuario->setCorreo($datos['Email']);
    $usuario->setTelefonoCel($datos['telefono']);
    
    if ($datos['foto']!="")
        $usuario->setFoto($datos['foto']);
    
     $usuario->Guardar();
     
     if ($usuario->getError()){
         $r->call('mostrarMsjError',$usuario->getStrSystemError(),5);
         return $r;
     }
     
     $r->call('mostrarMsjExito','Se actualiz&oacute; correctamente su informaci&oacute;n!',3);
     
     $r->redirect('miPerfil.php',2);
         
    
    return $r;
    
}

$xajax->registerFunction("guardar");

$xajax->processRequest();


// -----------------------------------------------------------------------------------------------------------------#
// -------------------------------------------Inicializacion de variables-------------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#
$usuario = new ModeloUsuario();
$usuario->setIdUsuario($objSession->getidUsuario());

$tipousuario = new ModeloTipoUsuario();
$tipousuario->setIdTipoUsuario($usuario->getIdTipoUsuario());

$sucursal = new ModeloSucursal();
$sucursal->setIdSucursal($usuario->getIdSucursal());
?>